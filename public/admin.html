<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dungeon of Habits Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Caesar+Dressing&display=swap" rel="stylesheet">
  <style>
    h1, h2, h3, h4 {
      font-family: 'Caesar Dressing', cursive;
    }
  </style>
  <script>
    let token = null;
    const API_BASE = "/api/admin";

    async function adminLogin() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      const res = await fetch(`${API_BASE}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, password })
      });

      const data = await res.json();
      if (data.token) {
        token = data.token;
        document.getElementById("login-section").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        loadUsers();
        loadMonsters();
        loadDungeons();
      } else {
        alert("Login failed: " + data.message);
      }
    }

    // ---------- USERS ----------
    async function loadUsers() {
  const res = await fetch(`${API_BASE}/users`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const users = await res.json();
  const list = document.getElementById("user-list");
  list.innerHTML = "";
  users.forEach(u => {
    list.innerHTML += `
      <tr class="border-b border-gray-700">
        <td class="px-4 py-2">${u.username}</td>
        <td class="px-4 py-2">Email: ${u.email}, Lvl: ${u.level}, Gold: ${u.gold}</td>
        <td class="px-4 py-2">
          <button onclick="deleteUser('${u._id}')" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white">‚ùå</button>
        </td>
      </tr>
    `;
  });
}


    async function deleteUser(id) {
    await fetch(`${API_BASE}/users/${id}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
    });
    loadUsers();
    }


    // ---------- MONSTERS ----------
    async function loadMonsters() {
  const res = await fetch(`${API_BASE}/monsters`, {
    headers: { Authorization: `Bearer ${token}` }
  });
  const monsters = await res.json();
  const list = document.getElementById("monster-list");
  list.innerHTML = "";
  monsters.forEach(m => {
    list.innerHTML += `
      <tr class="border-b border-gray-700">
        <td class="px-4 py-2">${m.name}\nID: ${m._id}</td>
        <td class="px-4 py-2">ATK: ${m.atk}, DEF: ${m.def}, HP: ${m.hp}, XP: ${m.xpReward}, Gold: ${m.goldReward}</td>
        <td class="px-4 py-2">
          <button onclick="deleteMonster('${m._id}')" class="bg-red-600 hover:bg-red-700 px-2 py-1 rounded text-white">‚ùå</button>
        </td>
      </tr>
    `;
  });
}



    async function addMonster() {
      const name = document.getElementById("m-name").value;
      const atk = parseInt(document.getElementById("m-atk").value);
      const def = parseInt(document.getElementById("m-def").value);
      const hp = parseInt(document.getElementById("m-hp").value);
      const xpReward = parseInt(document.getElementById("m-xp").value);
      const goldReward = parseInt(document.getElementById("m-gold").value);

      await fetch(`${API_BASE}/monsters`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
        body: JSON.stringify({ name, atk, def, hp, xpReward, goldReward })
      });
      loadMonsters();
    }

    async function deleteMonster(id) {
      await fetch(`${API_BASE}/monsters/${id}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
      });
      loadMonsters();
    }

    // ---------- DUNGEONS ----------
    async function loadDungeons() {
      const res = await fetch(`${API_BASE}/dungeons`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const dungeons = await res.json();
      const list = document.getElementById("dungeon-list");
      list.innerHTML = "";
      dungeons.forEach(d => {
        const monsterNames = d.monsters.map(m => m.name).join(", ");
        list.innerHTML += `
          <tr class="border-b border-gray-700">
            <td class="px-4 py-2">Floor ${d.floor}</td>
            <td class="px-4 py-2">${monsterNames}</td>
            <td class="px-4 py-2">
              <button class="bg-red-600 hover:bg-red-700 px-3 py-1 rounded text-white"
                onclick="deleteDungeon('${d._id}')">‚ùå Delete</button>
            </td>
          </tr>`;
      });
    }

    async function addDungeon() {
      const floor = parseInt(document.getElementById("d-floor").value);
      const monsterIds = document.getElementById("d-monsters").value.split(",");
      await fetch(`${API_BASE}/dungeons`, {
        method: "POST",
        headers: { "Content-Type": "application/json", Authorization: `Bearer ${token}` },
        body: JSON.stringify({ floor, monsters: monsterIds })
      });
      loadDungeons();
    }

    async function deleteDungeon(id) {
      await fetch(`${API_BASE}/dungeons/${id}`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
      });
      loadDungeons();
    }
  </script>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen">
  <!-- LOGIN -->
  <section id="login-section" class="flex items-center justify-center h-screen">
    <div class="bg-gray-800 p-8 rounded-xl shadow-lg w-80 text-center">
      <h2 class="text-2xl text-yellow-400 mb-6">Admin Login</h2>
      <input id="username" placeholder="Username" class="w-full mb-3 p-2 rounded bg-gray-700">
      <input id="password" type="password" placeholder="Password" class="w-full mb-3 p-2 rounded bg-gray-700">
      <button onclick="adminLogin()" class="w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold px-4 py-2 rounded">
        Login
      </button>
    </div>
  </section>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden p-8">
    <h1 class="text-3xl text-yellow-400 mb-6">Dungeon of Habits Admin Dashboard</h1>

    <!-- USERS -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
      <h2 class="text-2xl text-blue-400 mb-4">üë• Manage Users</h2>
      <table class="w-full text-left">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="px-4 py-2">Username</th>
            <th class="px-4 py-2">Stats</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="user-list"></tbody>
      </table>
    </div>

    <!-- MONSTERS -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
      <h2 class="text-2xl text-red-400 mb-4">üëπ Manage Monsters</h2>
      <table class="w-full text-left">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="px-4 py-2">Name</th>
            <th class="px-4 py-2">Stats</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="monster-list"></tbody>
      </table>

      <h3 class="text-lg text-gray-300 mt-6 mb-2">‚ûï Add Monster</h3>
      <div class="grid grid-cols-2 gap-2">
        <input id="m-name" placeholder="Name" class="p-2 rounded bg-gray-700">
        <input id="m-atk" placeholder="ATK" class="p-2 rounded bg-gray-700">
        <input id="m-def" placeholder="DEF" class="p-2 rounded bg-gray-700">
        <input id="m-hp" placeholder="HP" class="p-2 rounded bg-gray-700">
        <input id="m-xp" placeholder="XP Reward" class="p-2 rounded bg-gray-700">
        <input id="m-gold" placeholder="Gold Reward" class="p-2 rounded bg-gray-700">
      </div>
      <button onclick="addMonster()" class="mt-3 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-white">
        Add Monster
      </button>
    </div>

    <!-- DUNGEONS -->
    <div class="bg-gray-800 p-6 rounded-xl shadow-lg">
      <h2 class="text-2xl text-green-400 mb-4">üè∞ Manage Dungeons</h2>
      <table class="w-full text-left">
        <thead>
          <tr class="border-b border-gray-700">
            <th class="px-4 py-2">Floor</th>
            <th class="px-4 py-2">Monsters</th>
            <th class="px-4 py-2">Actions</th>
          </tr>
        </thead>
        <tbody id="dungeon-list"></tbody>
      </table>

      <h3 class="text-lg text-gray-300 mt-6 mb-2">‚ûï Add Dungeon</h3>
      <div class="grid grid-cols-2 gap-2">
        <input id="d-floor" placeholder="Floor" class="p-2 rounded bg-gray-700">
        <input id="d-monsters" placeholder="Monster IDs (comma separated)" class="p-2 rounded bg-gray-700 col-span-2">
      </div>
      <button onclick="addDungeon()" class="mt-3 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-white">
        Add Dungeon
      </button>
    </div>
  </section>
</body>
</html>
